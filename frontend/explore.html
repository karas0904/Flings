<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Explore</title>
    <link rel="icon" type="image/svg" href="assets/icons/Logo.svg" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+Display:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background: #000;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        margin: 0;
      }

      .blur-shape {
        position: absolute;
        width: 250px;
        height: 500px;
        border-radius: 50px;
        filter: blur(100px);
        z-index: -1;
        opacity: 0.4;
      }

      .red-shape {
        background: rgba(255, 0, 0, 0.7);
        top: -50px;
        left: -100px;
        transform: rotate(45deg);
      }

      .blue-shape {
        background: rgba(135, 206, 250, 0.7);
        bottom: -50px;
        right: -100px;
        transform: rotate(45deg);
      }

      .phone-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 360px;
        height: 700px;
        background: #fff;
        border-radius: 20px;
        box-shadow: 10px 10px 30px rgba(0, 0, 0, 0.5);
        z-index: 10;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .profile-list {
        flex-grow: 1;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        -webkit-overflow-scrolling: touch;
        padding: 0;
        outline: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
        transition: filter 0.7s ease-in-out, opacity 0.7s ease-in-out;
      }

      .profile-list::-webkit-scrollbar {
        display: none;
      }

      .profile-card {
        background: #f5f5f5;
        border-radius: 0;
        height: 700px;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: flex-start;
        padding: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .profile-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 100%;
        background-image: linear-gradient(
          to top,
          rgba(0, 0, 0, 8) 0%,
          rgba(0, 0, 0, 0.9) 25%,
          transparent 90%
        );
        z-index: 1;
      }

      .profile-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 0;
      }

      .profile-info {
        padding: 25px 5px;
        text-align: left;
        z-index: 2;
        margin-bottom: 60px;
      }

      @font-face {
        font-family: "Agraham";
        src: url("fonts/Agraham.otf") format("opentype");
        font-weight: normal;
        font-style: normal;
      }

      .profile-info h3 {
        margin: 10px;
        font-size: 22px;
        font-family: "Agraham", sans-serif;
        color: #fbfafa;
      }

      .profile-age {
        font-family: "Noto Serif Display", serif;
        font-optical-sizing: auto;
        font-style: normal;
        font-variation-settings: "wdth" 100;
        font-size: 20px;
        color: #ffffff;
      }

      .profile-info p {
        margin: 0;
        font-size: 13px;
        padding-left: 10px;
        color: #ffffff;
      }

      .profile-details-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 360px;
        height: 700px;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        z-index: 20;
        display: flex;
        flex-direction: column;
        padding: 0;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0.7s;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      .profile-details-box.active {
        opacity: 1;
        visibility: visible;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0s;
      }

      .detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background-color: #ffffff;
        position: sticky;
        top: 0;
        width: 100%;
        z-index: 30;
      }

      .detail-header h3 {
        font-size: 28px;
        font-weight: bold;
        color: #333;
        margin: 0;
        padding-left: 10px;
      }

      .detail-header .profile-details-close {
        width: 35px;
        height: 35px;
        background-color: rgba(2, 2, 2, 0.84);
        box-shadow: 5px 1px 20px rgba(0, 0, 0, 0.2);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 22px;
        color: #f9f7f7;
        cursor: pointer;
        line-height: 35px;
      }

      .profile-list.blur {
        filter: blur(10px);
        opacity: 0.3;
        transition: filter 0.7s ease-in-out, opacity 0.9s ease-in-out;
        pointer-events: none;
      }

      .profile-details-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        padding-top: 20px;
        padding-bottom: 50px;
        text-align: center;
        width: 100%;
      }

      .profile-details-box::-webkit-scrollbar {
        display: none;
      }

      .profile-details-box {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .profile-details-content h3 {
        font-size: 24px;
        margin-bottom: 10px;
        color: #333;
      }

      .profile-details-content p {
        font-size: 16px;
        color: #666;
        margin-bottom: 10px;
      }

      .detail-section img {
        display: block;
        width: 90%;
        border-radius: 10px 10px 0px 0px;
        height: auto;
        margin: 0 auto;
        max-width: 360px;
        object-fit: cover;
      }

      .detail-section {
        margin: 20px 0;
      }

      .detail-section h3 {
        font-size: 28px;
        font-weight: bold;
        color: #333;
        text-align: center;
        margin: 0;
      }

      .detail-section .placeholder {
        font-style: italic;
        color: #444;
        text-align: center;
        box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.243);
        padding: 10px 70px;
        background: #e6e6e662;
        height: 150px;
        width: auto; /* Automatically adjusts the width to content */
        max-width: 90%; /* Optional: limits the width of the box */
        border-radius: 10px;
        display: flex;
        align-items: center; /* Vertically center the text */
        justify-content: center; /* Horizontally center the text */
        margin: 0 auto; /* Horizontally center the box within its container */
      }

      .detail-section p {
        font-size: 16px;
        color: #555;
        text-align: center;
        margin: 0;
      }

      .detail-section .quote {
        font-style: italic;
        color: #444;
        text-align: center;
        padding: 10px 70px;
        background: #e6e6e662;
        box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.243);
        height: 200px;
        width: auto; /* Automatically adjusts the width to content */
        max-width: 90%; /* Optional: limits the width of the box */
        border-radius: 10px;
        display: flex;
        align-items: center; /* Vertically center the text */
        justify-content: center; /* Horizontally center the text */
        margin: 0 auto; /* Horizontally center the box within its container */
      }

      .detail-heart-button {
        position: absolute;
        bottom: 20px; /* Adjusted to be at the bottom-right of the image */
        right: 30px;
        width: 50px;
        height: 50px;
        background: #fd9999; /* Light pink */
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 7px 20px #000000a4;
        transition: transform 0.3s ease, background 0.3s ease;
        z-index: 10; /* Ensure it stays above the image */
      }

      .detail-heart-button:hover {
        width: 55px;
        height: 55px;
        transition: 0.3s;
      }

      .detail-heart-button.active {
        background: rgba(255, 58, 94, 0.8); /* Red when active */
      }

      .detail-heart-button .heart-icon {
        width: 24px;
        height: 24px;
        filter: brightness(0) invert(1); /* White by default */
        transition: filter 0.3s ease;
      }

      .detail-heart-button.active .heart-icon {
        filter: brightness(100%) saturate(100%) invert(100%) sepia(100%)
          hue-rotate(0deg); /* Red when active */
      }

      /* Adjust the details section to be smaller and stick below the image */
      #detailsSection {
        margin: 0; /* Remove margin to stick it right below the image */
        padding: 5px 0; /* Reduce padding for a tighter fit */
        position: sticky; /* Optional: sticks it relative to scrolling content */
        top: 0; /* Adjust based on image height if needed */
      }

      /* Ensure the scroll container is horizontally scrollable and smaller */
      .scroll-container {
        overflow-x: auto;
        white-space: nowrap;
        border-radius: 0px 0px 10px 10px;
        padding: 15px;
        height: 50px;
        max-width: 90%;
        max-height: 50px;
        -webkit-overflow-scrolling: touch;
        background-color: #d5d5d56d;
        display: flex;
        align-items: center;
        margin-top: -1.4% !important;
        margin: 0 auto;
      }

      .scroll-container::-webkit-scrollbar {
        display: none; /* Chrome, Safari, and Opera */
      }

      .scroll-container .scroll-item {
        display: inline-flex;
        align-items: center;
        font-size: 12px;
        color: #555;
        margin: 0;
        padding: 0 15px; /* Increased padding for good gap between items */
      }

      .scroll-container .scroll-item i {
        margin-right: 12px; /* Space between icon and text */
        font-size: 12px;
        margin-left: 5px;
        color: #333;
      }

      .scroll-container .scroll-item:not(:last-child)::after {
        content: "|";
        margin-left: 30px; /* Space after the vertical bar */
        color: #888;
      }

      .scroll-container p {
        display: inline;
        font-size: 18px; /* Smaller font size */
        color: #555;
        padding: 0 20px; /* Adjusted horizontal padding */
        margin: 0;
        line-height: 30px; /* Increased line height for better spacing */
      }

      /* Ensure the image section doesn't interfere */
      #imageSection {
        position: relative;
        margin-bottom: 0; /* Remove bottom margin to connect with details */
      }

      .profile-info h3,
      .profile-info p {
        cursor: pointer;
      }

      .button-container {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 2;
      }

      .heart-button {
        width: 50px;
        height: 50px;
        background: #fd9999; /* Light pink background stays constant */
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 7px 20px #000000a4;
      }

      .heart-button:hover {
        width: 55px;
        height: 55px;
        transition: 0.3s;
      }

      .heart-icon {
        width: 24px;
        height: 24px;
        filter: brightness(0) invert(1); /* White by default */
        transition: filter 0.3s ease, transform 0.3s ease;
      }

      /* Remove .heart-button.active styling and update heart icon active state */
      .heart-button.active .heart-icon {
        filter: brightness(100%) saturate(100%) invert(23%) sepia(91%)
          saturate(6645%) hue-rotate(355deg) brightness(106%) contrast(119%); /* Red when active */
        animation: heartIconBeat 1s ease;
      }

      /* New animation specifically for the heart icon */
      @keyframes heartIconBeat {
        0% {
          transform: scale(1);
        }
        20% {
          transform: scale(1.2);
        }
        40% {
          transform: scale(1);
        }
        60% {
          transform: scale(1.2);
        }
        80% {
          transform: scale(1);
        }
        100% {
          transform: scale(1);
        }
      }

      .no-named-button {
        width: 50px;
        height: 50px;
        background: #000;
        border: 1px solid #ccc;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 16px;
        color: #fff;
      }

      .no-named-button:hover {
        width: 55px;
        height: 55px;
        transition: 0.3s;
      }

      .comment-inbox {
        flex-grow: 1;
        margin: 0 10px;
        background: #f5f5f5;
        border-radius: 20px;
      }

      .comment-inbox:hover {
        transform: perspective(1000px) rotateX(0deg);
        box-shadow: 7px 7px 20px rgba(0, 0, 0, 0.25),
          -2px -2px 10px rgba(251, 249, 249, 0.8);
      }

      .comment-input {
        width: 100%;
        height: 40px;
        padding: 10px;
        border-radius: 20px;
        font-size: 14px;
        color: #333;
        border: none;
        background: #e0e0e0;
        transition: box-shadow 0.3s ease;
      }

      .comment-input:focus {
        outline: none;
      }

      .comment-input:disabled {
        background: #e0e0e0; /* Keep the same background */
        color: #999; /* Gray out the text for a disabled look */
        cursor: not-allowed; /* Show a "not allowed" cursor */
      }

      .external-buttons {
        position: absolute;
        top: calc(50% + 190px);
        left: calc(50% + 195px);
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 15px;
        z-index: 15;
      }

      .external-buttons button {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border: 0px solid rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        color: #fff;
        transition: background 0.3s ease;
      }

      .external-buttons button:hover {
        background: rgba(255, 255, 255, 0.4);
      }

      .external-buttons button[title="Save"] {
        background: radial-gradient(
          circle at 30% 30%,
          rgba(255, 255, 255, 0.25),
          rgba(255, 255, 255, 0.1) 70%,
          rgba(255, 255, 255, 0.05)
        );
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        color: #fff;
        transition: background 0.3s ease, transform 0.3s ease,
          box-shadow 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2),
          inset 0 4px 8px rgba(255, 255, 255, 0.5),
          inset 0 -2px 6px rgba(0, 0, 0, 0.15);
        transform: perspective(500px) translateZ(5px);
      }

      .external-buttons button[title="Save"] i {
        font-weight: 400;
      }

      .external-buttons button[title="Save"].saved {
        background: radial-gradient(
          circle at 30% 30%,
          rgba(255, 255, 255, 0.45),
          rgba(255, 255, 255, 0.2) 70%,
          rgba(255, 255, 255, 0.05)
        );
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3),
          inset 0 4px 12px rgba(255, 255, 255, 0.7),
          inset 0 -2px 6px rgba(0, 0, 0, 0.25);
        transform: perspective(500px) translateZ(3px);
      }

      .external-buttons button[title="Save"].saved i {
        font-weight: 900;
        color: #fff;
      }

      .external-buttons button[title="Share"] {
        background: radial-gradient(
          circle at 30% 30%,
          rgba(255, 255, 255, 0.25),
          rgba(255, 255, 255, 0.1) 70%,
          rgba(255, 255, 255, 0.05)
        );
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.3s ease,
          box-shadow 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2),
          inset 0 4px 8px rgba(255, 255, 255, 0.5),
          inset 0 -2px 6px rgba(0, 0, 0, 0.15);
        transform: perspective(500px) translateZ(5px);
      }

      .share-options {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 360px;
        background: rgba(233, 237, 233, 0.992);
        border-radius: 15px 15px 0 0;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        padding: 15px;
        flex-direction: row;
        justify-content: center;
        gap: 20px;
        z-index: 20;
        transform: translateY(100%);
        opacity: 0;
        max-height: 0;
        overflow: hidden;
        transition: transform 0.5s ease, opacity 0.5s ease, max-height 0.5s ease;
        border: 1px solid rgba(235, 241, 235, 0.465);
      }

      .share-options.active {
        max-height: 150px;
        opacity: 1;
        transform: translateY(0);
      }

      .share-option {
        background: transparent;
        border: none;
        border-radius: 0;
        padding: 20px 15px;
        font-size: 16px;
        color: #040404;
        cursor: pointer;
        text-align: center;
        transition: color 0.3s ease, transform 0.2s ease;
        font-family: Arial, sans-serif;
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
      }

      .share-option:hover {
        color: #000000;
        transform: translateY(-5px);
      }

      .share-option i {
        font-size: 18px;
        color: inherit;
      }

      .share-option.whatsapp::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 0;
        width: 0;
        height: 2px;
        background: #25d366;
        transition: width 0.4s ease;
      }

      .share-option.whatsapp:hover::after {
        width: 100%;
      }

      .share-option.twitter::after {
        content: "";
        position: absolute;
        bottom: 5px;
        left: 0;
        width: 0;
        height: 2px;
        background: #1da1f2;
        transition: width 0.4s ease;
      }

      .share-option.twitter:hover::after {
        width: 100%;
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 30px;
        background-color: transparent;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
      }

      .navbar .logo {
        font-size: 24px;
        font-weight: bold;
        font-family: Arial, sans-serif;
        color: #fff;
      }

      .navbar .nav-links {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
      }

      .navbar .nav-links a {
        font-size: 18px;
        font-family: Arial, sans-serif;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        margin: 0 10px;
        transition: color 0.3s;
      }

      .navbar .nav-links a:hover {
        color: #fff;
      }

      .navbar .nav-links a:nth-child(2) {
        margin: 0 10px;
        color: rgba(255, 255, 255, 0.8);
        cursor: default;
      }

      .navbar .nav-links a:nth-child(2):hover {
        color: rgba(255, 255, 255, 0.8);
      }

      .navbar .hamburger {
        font-size: 24px;
        color: #fff;
        cursor: pointer;
        transition: opacity 0.3s ease;
        z-index: 1100;
        position: relative;
      }

      .navbar .hamburger.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .side-navbar {
        height: 100%;
        width: 450px;
        position: fixed;
        top: 0;
        right: -450px;
        background: rgba(0, 0, 0, 0.325);
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: right 0.3s ease;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        color: #fff;
        z-index: 1000;
      }

      .side-navbar.active {
        right: 0;
        z-index: 1200;
      }

      .close-icon {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 24px;
        color: #fff;
        cursor: pointer;
        z-index: 1200;
      }

      .side-navbar .top-items {
        padding-top: 60px;
        text-align: left;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
      }

      .side-navbar .top-items a {
        color: #fff;
        text-decoration: none;
        display: block;
        padding: 8px 0;
        font-size: 15px;
        transition: transform 0.3s ease, filter 0.3s ease;
      }

      .side-navbar .top-items a:hover {
        transform: scale(1.05);
      }

      .side-navbar .top-items .description {
        font-size: 10px;
        font-style: italic;
        color: white;
        margin-top: 1px;
        margin-bottom: 8px;
      }

      .side-navbar .bottom-buttons {
        margin-bottom: 20px;
      }

      .side-navbar .bottom-buttons button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        font-size: 16px;
        color: #fff;
        background-color: rgba(57, 55, 55, 0.484);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .side-navbar .bottom-buttons button:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .account-section {
        display: flex;
        align-items: center;
        height: 90px;
        margin-bottom: 20px;
      }

      .account-image {
        width: 120px;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        margin-right: 15px;
      }

      .account-info .account-name {
        margin-top: 80px;
        font-size: 18px;
        font-weight: bold;
        color: #fff;
      }

      .account-info .account-details {
        font-size: 10px;
        font-style: italic;
        color: rgba(255, 255, 255, 0.8);
        margin-top: 2px;
      }

      .side-navbar .middle-left {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-left: 20px;
        margin-top: 50%;
      }

      .side-navbar .middle-left a {
        color: #fff;
        text-decoration: none;
        font-size: 15px;
        padding: 8px 0;
        transition: transform 0.3s ease, filter 0.3s ease;
      }

      .side-navbar .middle-left a:hover {
        transform: scale(1.05);
      }

      .side-navbar .middle-left .description {
        font-size: 10px;
        font-style: italic;
        color: white;
        margin-top: 1px;
        margin-bottom: 8px;
      }

      .rose-button {
        background: rgba(255, 58, 94, 0.8) !important;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        color: #fff;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2),
          inset 0 4px 8px rgba(255, 255, 255, 0.3),
          inset 0 -2px 6px rgba(0, 0, 0, 0.15);
        transform: perspective(500px) translateZ(5px);
        overflow: hidden;
        position: relative;
        z-index: 20;
      }

      .rose-button .rose-icon {
        width: 40px;
        height: 40px;
        transition: transform 0.3s ease;
      }

      .rose-button:hover {
        transform: perspective(500px) translateZ(10px) scale(1.1);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25),
          inset 0 4px 10px rgba(255, 255, 255, 0.6),
          inset 0 -2px 6px rgba(0, 0, 0, 0.2);
      }

      .rose-button.active {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3),
          inset 0 4px 12px rgba(255, 255, 255, 0.7),
          inset 0 -2px 6px rgba(0, 0, 0, 0.25);
        transform: perspective(500px) translateZ(3px);
      }

      .rose-button.active .rose-icon {
        transform: scale(1.1);
      }

      .rose-button::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 30%;
        height: 100%;
        background: linear-gradient(
          120deg,
          transparent,
          rgba(255, 255, 255, 0.8) 50%,
          transparent
        );
        transform: skewX(-20deg);
        transition: none;
        pointer-events: none;
      }

      .rose-button.shine::after {
        animation: shine 0.6s linear forwards;
      }

      @keyframes shine {
        0% {
          left: -100%;
        }
        60% {
          left: 100%;
        }
        100% {
          left: 100%;
        }
      }

      @keyframes heartbeat {
        0% {
          transform: scale(1);
        }
        20% {
          transform: scale(1.2);
        }
        40% {
          transform: scale(1);
        }
        60% {
          transform: scale(1.2);
        }
        80% {
          transform: scale(1);
        }
        100% {
          transform: scale(1.2);
        }
      }

      /* Disabled state for rose button */
      .rose-button:disabled {
        background: rgba(255, 58, 94, 0.3) !important; /* Faded red */
        cursor: not-allowed;
        box-shadow: none;
        transform: perspective(500px) translateZ(0);
      }

      .rose-button:disabled:hover {
        transform: perspective(500px) translateZ(0); /* No hover effect */
      }

      /* Container for comment input and send icon */
      .comment-inbox {
        position: relative; /* For positioning the send icon */
        display: flex;
        align-items: center;
      }

      /* Style for the send icon */
      .send-icon {
        position: absolute;
        right: 10px;
        width: 20px;
        height: 20px;
        cursor: pointer;
        display: none; /* Hidden by default */
        transition: opacity 0.3s ease;
      }

      /* Show send icon when comment is enabled */
      .comment-inbox.enabled .send-icon {
        display: block;
      }

      /* Adjust input padding to avoid overlap with send icon */
      .comment-input.enabled {
        padding-right: 35px; /* Space for the send icon */
      }

      /* Loading overlay for profile list */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(
          255,
          255,
          255,
          0.95
        ); /* White background to match phone-box */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 15; /* Above profile-list but below profile-details-box */
        transition: opacity 0.5s ease-out;
      }

      .loading-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      /* Cube grid animation */
      .loading-animation {
        width: 60px;
        height: 60px;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
      }

      .cube-grid {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px;
      }

      .cube {
        width: 15px;
        height: 15px;
        border-radius: 50px;
        background: #ff0000; /* Dark gray cubes */
        transform: scale(1);
        animation: cubePulse 1.5s infinite ease-in-out;
      }

      /* Staggered animation delays for a wave effect */
      .cube:nth-child(1) {
        animation-delay: 0s;
      }
      .cube:nth-child(2) {
        animation-delay: 0.1s;
      }
      .cube:nth-child(3) {
        animation-delay: 0.2s;
      }
      .cube:nth-child(4) {
        animation-delay: 0.1s;
      }
      .cube:nth-child(5) {
        animation-delay: 0.2s;
      }
      .cube:nth-child(6) {
        animation-delay: 0.3s;
      }
      .cube:nth-child(7) {
        animation-delay: 0.2s;
      }
      .cube:nth-child(8) {
        animation-delay: 0.3s;
      }
      .cube:nth-child(9) {
        animation-delay: 0.4s;
      }

      @keyframes cubePulse {
        0%,
        100% {
          transform: scale(1);
          background: #ff0000;
        }
        50% {
          transform: scale(1.3);
          background: #ff0000d3; /* Lighter gray at peak */
        }
      }
      .custom-alert-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
      }

      .custom-alert-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .custom-alert-box {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: auto;
        max-width: 400px;
        background: rgba(243, 8, 8, 0.01);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        position: fixed; /* Fixed to position relative to viewport */
        top: 20px; /* Distance from top */
        right: 20px; /* Distance from right */
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        transform: translateX(100%); /* Start off-screen to the right */
        opacity: 0; /* Start invisible */
      }

      /* Active state when the alert is shown */
      .custom-alert-overlay.active .custom-alert-box {
        transform: translateX(0); /* Slide in to visible position */
        opacity: 1; /* Fully visible */
        pointer-events: auto; /* Allow interaction */
      }

      .custom-alert-box p {
        margin: 0 0 15px;
        font-size: 16px;
        color: white;
      }

      .custom-alert-button {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 20px;
        border: none;
        padding: 10px 20px;
        margin-right: 250px;
        text-decoration: none;
        transition: background 0.3s;
        font-size: 8px;
        font-family: "Open Sans", sans-serif;
        display: inline-block;
        margin-top: 10px;
        position: relative;
        cursor: pointer;
      }

      .custom-alert-button:hover {
        background-color: rgba(255, 255, 255, 0.4);
      }
    </style>
  </head>
  <body>
    <div class="blur-shape red-shape"></div>
    <div class="blur-shape blue-shape"></div>

    <div class="phone-box">
      <div class="profile-list" id="profileList" tabindex="0"></div>
      <div class="loading-overlay" id="profileLoadingOverlay">
        <div class="loading-animation">
          <div class="cube-grid">
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
            <div class="cube"></div>
          </div>
        </div>
      </div>
      <div class="profile-details-box" id="profileDetailsBox">
        <div class="detail-header" id="detailHeader">
          <h3 id="profileName"></h3>
          <div class="profile-details-close" onclick="closeProfileDetails()">
            ✕
          </div>
        </div>
        <div class="profile-details-content" id="profileDetailsContent">
          <div class="detail-section" id="imageSection">
            <img id="profileImage" alt="Profile Image" />
            <button
              class="heart-button detail-heart-button"
              id="detailHeartButton"
            >
              <img
                src="/assets/icons/heart-icon.png"
                alt="Heart Icon"
                class="heart-icon"
              />
            </button>
          </div>
          <div class="detail-section" id="detailsSection">
            <div class="scroll-container" id="scrollContainer">
              <!-- Content will be dynamically added via JS -->
            </div>
          </div>
          <!-- Dynamic content will be added here via JavaScript -->
        </div>
      </div>
      <div class="share-options" id="shareOptions">
        <div class="share-option whatsapp" data-platform="whatsapp">
          <i class="fab fa-whatsapp"></i> WhatsApp
        </div>
        <div class="share-option twitter" data-platform="twitter">
          <i class="fab fa-twitter"></i> Twitter
        </div>
      </div>
    </div>

    <div class="custom-alert-overlay" id="customAlertOverlay">
      <div class="custom-alert-box" id="customAlertBox">
        <p id="customAlertMessage"></p>
        <button class="custom-alert-button" id="customAlertButton">OK</button>
      </div>
    </div>

    <div class="external-buttons">
      <button title="Rose" class="rose-button">
        <img src="assets/icons/rose-icon.svg" alt="Rose" class="rose-icon" />
      </button>
      <button title="Save">
        <i class="fa-solid fa-bookmark"></i>
      </button>
      <button title="Share" id="shareButton">
        <i class="fa-solid fa-paper-plane"></i>
      </button>
    </div>

    <nav class="navbar">
      <div class="logo">Amourette</div>
      <div class="nav-links">
        <a href="">explore</a>
        <a href="">|</a>
        <a href="trending.html">trending</a>
      </div>
      <div class="hamburger" onclick="toggleSidebar()">☰</div>
    </nav>

    <div class="side-navbar" id="sideNavbar">
      <div class="close-icon" onclick="toggleSidebar()">✕</div>
      <div class="top-items">
        <div class="account-section">
          <a href="account.html">
            <img
              src="try-image.jpg"
              alt="Account Image"
              class="account-image"
            />
          </a>
          <div class="account-info">
            <div class="account-name">John Doe</div>
            <div class="account-details">Age: 21 | Study Year: 3rd</div>
          </div>
        </div>
        <div class="middle-left">
          <a href="messages.html">MESSAGES</a>
          <div class="description">(See what your connections have to say)</div>
          <a href="saves.html">SAVES</a>
          <div class="description">(See the accounts you have saved)</div>
        </div>
      </div>
      <div class="bottom-buttons">
        <button onclick="logout()">Logout</button>
      </div>
    </div>

    <script>
      // Function to show custom alert
      function showCustomAlert(message) {
        const overlay = document.getElementById("customAlertOverlay");
        const messageElement = document.getElementById("customAlertMessage");
        const button = document.getElementById("customAlertButton");

        messageElement.textContent = message;
        overlay.classList.add("active");

        return new Promise((resolve) => {
          button.onclick = () => {
            overlay.classList.remove("active");
            resolve();
          };
          overlay.onclick = (e) => {
            if (e.target === overlay) {
              overlay.classList.remove("active");
              resolve();
            }
          };
          document.addEventListener("keydown", function handler(e) {
            if (e.key === "Enter" || e.key === "Escape") {
              overlay.classList.remove("active");
              document.removeEventListener("keydown", handler);
              resolve();
            }
          });
        });
      }

      // Function to clear URL parameters
      function clearUrlParams() {
        const url = new URL(window.location);
        url.search = ""; // Clear all query parameters
        window.history.replaceState({}, document.title, url);
      }

      // Function to store token and user data from URL
      function storeTokenAndUser() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get("token");
        const user = urlParams.get("user");

        if (token && user) {
          localStorage.setItem("jwtToken", token);
          localStorage.setItem("user", decodeURIComponent(user));
          console.log("JWT token stored:", token);
          console.log("User stored:", JSON.parse(decodeURIComponent(user)));
          clearUrlParams();
        } else if (token) {
          localStorage.setItem("jwtToken", token);
          console.log("JWT token stored, fetching user data...");
          fetchUserData(token);
        } else {
          console.error("No token found in URL parameters");
        }
      }

      // Fallback to fetch user data if only token is provided
      async function fetchUserData(token) {
        try {
          const response = await fetch("http://localhost:3000/api/profile", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || "Failed to fetch user data");
          }

          const userData = await response.json();
          localStorage.setItem("user", JSON.stringify(userData));
          console.log("User data fetched and stored:", userData);
        } catch (error) {
          console.error("Error fetching user data:", error);
        }
      }

      // Function to fetch user profile from backend
      async function fetchUserProfile() {
        const token = localStorage.getItem("jwtToken");
        if (!token) {
          console.error("No JWT token found in localStorage");
          return;
        }

        try {
          const response = await fetch("http://localhost:3000/api/profile", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || "Failed to fetch profile");
          }

          const userData = await response.json();
          console.log("Fetched user profile:", userData);
          updateSidebar(userData);
        } catch (error) {
          console.error("Error fetching profile:", error);
        }
      }

      // Function to fetch all profiles from backend
      async function fetchProfiles() {
        const token = localStorage.getItem("jwtToken");
        const loadingOverlay = document.getElementById("profileLoadingOverlay");

        if (loadingOverlay) {
          loadingOverlay.classList.remove("hidden");
        }

        if (!token) {
          await showCustomAlert("Please log in!");
          window.location.href = "login.html";
          if (loadingOverlay) {
            loadingOverlay.classList.add("hidden");
          }
          return [];
        }

        try {
          // Fetch all profiles
          const profilesResponse = await fetch(
            "http://localhost:3000/api/profiles",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );
          if (!profilesResponse.ok) {
            throw new Error(
              "Failed to fetch profiles: " + profilesResponse.status
            );
          }
          let profiles = await profilesResponse.json();
          console.log("Raw profiles from /api/profiles:", profiles);

          if (!Array.isArray(profiles)) {
            console.error("Profiles response is not an array:", profiles);
            throw new Error("Invalid profiles data format");
          }
          profiles = profiles.filter(
            (profile) =>
              profile &&
              typeof profile === "object" &&
              profile._id !== undefined
          );
          console.log("Filtered profiles:", profiles);

          // Fetch the current user's likes (incoming and outgoing)
          const likesResponse = await fetch(
            "http://localhost:3000/api/liked-profiles",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );
          if (!likesResponse.ok) {
            throw new Error("Failed to fetch likes: " + likesResponse.status);
          }
          const myLikes = await likesResponse.json();
          console.log("Raw likes from /api/liked-profiles:", myLikes);
          const likedProfileIds = new Set(
            Array.isArray(myLikes.profiles)
              ? myLikes.profiles
                  .filter(
                    (like) =>
                      like.direction === "outgoing" ||
                      like.direction === "matched"
                  )
                  .map((like) => like.id?.toString())
                  .filter(Boolean)
              : []
          );

          // Fetch the current user's saved profiles
          const savedResponse = await fetch(
            "http://localhost:3000/api/saved-profiles",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );
          if (!savedResponse.ok) {
            throw new Error(
              "Failed to fetch saved profiles: " + savedResponse.status
            );
          }
          const savedProfiles = await savedResponse.json();
          console.log(
            "Raw saved profiles from /api/saved-profiles:",
            savedProfiles
          );
          const savedProfileIds = new Set(
            Array.isArray(savedProfiles)
              ? savedProfiles
                  .map((saved) => saved._id?.toString())
                  .filter(Boolean)
              : []
          );

          // Fetch sent roses and comments
          const rosesResponse = await fetch(
            "http://localhost:3000/api/sent-roses",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );
          if (!rosesResponse.ok) {
            throw new Error("Failed to fetch roses: " + rosesResponse.status);
          }
          const myRoses = await rosesResponse.json();
          console.log("Raw roses from /api/sent-roses:", myRoses);
          const roseData = new Map(
            myRoses && Array.isArray(myRoses.roses)
              ? myRoses.roses
                  .filter((rose) => rose.toUserId)
                  .map((rose) => [
                    rose.toUserId.toString(),
                    { hasRose: true, comment: rose.comment || "" },
                  ])
              : []
          );

          // Add like, save, and rose/comment status to profiles
          const profilesWithStatus = profiles.map((profile) => {
            const profileIdStr = profile._id.toString();
            const roseInfo = roseData.get(profileIdStr) || {
              hasRose: false,
              comment: "",
            };
            return {
              ...profile,
              isLiked: likedProfileIds.has(profileIdStr), // True if user liked this profile (outgoing or matched)
              isSaved: savedProfileIds.has(profileIdStr),
              hasRose: roseInfo.hasRose,
              comment: roseInfo.comment,
            };
          });

          if (loadingOverlay) {
            loadingOverlay.classList.add("hidden");
          }

          return profilesWithStatus;
        } catch (error) {
          console.error(
            "Error fetching profiles, likes, saves, or roses:",
            error
          );
          if (loadingOverlay) {
            loadingOverlay.classList.add("hidden");
          }
          return [];
        }
      }

      // Function to update sidebar with user data
      function updateSidebar(userData) {
        const accountImage = document.querySelector(".account-image");
        const accountName = document.querySelector(".account-name");
        const accountDetails = document.querySelector(".account-details");

        if (userData.photos && userData.photos.length > 0) {
          accountImage.src = userData.photos[0];
        } else {
          accountImage.src = "default-profile.jpg"; // Fallback image
        }
        accountName.textContent = userData.firstName || "Unknown";
        accountDetails.textContent = `Age: ${userData.age || "N/A"} | Year: ${
          userData.year || "N/A"
        }`;
      }

      // Logout function
      async function logout() {
        const button = document.querySelector(
          ".side-navbar .bottom-buttons button"
        );
        button.textContent = "Logging Out...";
        button.disabled = true;

        const token = localStorage.getItem("jwtToken");
        if (token) {
          try {
            const response = await fetch("http://localhost:3000/api/logout", {
              method: "POST",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            });

            if (!response.ok) {
              console.error("Logout failed on server:", response.status);
            } else {
              console.log("Successfully logged out on server");
            }
          } catch (error) {
            console.error("Error during logout:", error);
          }
        }

        localStorage.removeItem("jwtToken");
        localStorage.removeItem("user");
        window.location.href = "login.html";

        button.textContent = "Logout";
        button.disabled = false;
      }

      // Main DOMContentLoaded event listener
      document.addEventListener("DOMContentLoaded", async function () {
        storeTokenAndUser();
        fetchUserProfile();

        let loadedProfiles = 0;
        const profilesPerPage = 1;
        let profiles = [];

        profiles = await fetchProfiles();
        console.log("Profiles loaded:", profiles);
        loadProfiles(); // Explicitly call to load initial profiles

        function loadProfiles() {
          console.log(
            "loadProfiles called with loadedProfiles:",
            loadedProfiles
          );
          console.log("Profiles array:", profiles);
          const start = loadedProfiles;
          const end = Math.min(
            loadedProfiles + profilesPerPage,
            profiles.length
          );

          const profileList = document.getElementById("profileList");

          if (profiles.length === 0 || start >= profiles.length) {
            console.log("No profiles to load or end reached");
            const noMoreProfiles = document.createElement("div");
            noMoreProfiles.classList.add("profile-card");
            noMoreProfiles.textContent = "No more profiles to show";
            noMoreProfiles.style.textAlign = "center";
            noMoreProfiles.style.fontSize = "18px";
            noMoreProfiles.style.color = "#666";
            profileList.appendChild(noMoreProfiles);
            return;
          }

          for (let i = start; i < end; i++) {
            const profile = profiles[i];
            console.log(
              `Appending profile: ${profile.name}, ID: ${profile._id}, isLiked: ${profile.isLiked}`
            );
            const profileCard = document.createElement("div");
            profileCard.classList.add("profile-card");

            const profileImage = document.createElement("img");
            profileImage.classList.add("profile-image");
            profileImage.src = profile.image || "default-image.jpg";
            profileImage.alt = `${profile.name}'s profile image`;

            const profileInfo = document.createElement("div");
            profileInfo.classList.add("profile-info");

            const profileNameAge = document.createElement("h3");
            profileNameAge.innerHTML = `${
              profile.name || "Unknown"
            }, <span class="profile-age">${profile.age || "N/A"}</span>`;
            const profileDetails = document.createElement("p");
            profileDetails.classList.add("profile-details");
            profileDetails.textContent = `${profile.hometown || "N/A"} | ${
              profile.year || "N/A"
            } | ${profile.department || "N/A"}`;
            const profileBio = document.createElement("p");
            profileBio.classList.add("profile-bio");
            profileBio.textContent = profile.bio || "No bio available";

            profileInfo.appendChild(profileNameAge);
            profileInfo.appendChild(profileDetails);
            profileInfo.appendChild(profileBio);

            const buttonContainer = document.createElement("div");
            buttonContainer.classList.add("button-container");

            const noNamedButton = document.createElement("button");
            noNamedButton.classList.add("no-named-button");
            noNamedButton.innerHTML = '<i class="fa-solid fa-xmark"></i>';

            const commentInbox = document.createElement("div");
            commentInbox.classList.add("comment-inbox");
            const commentInput = document.createElement("input");
            commentInput.type = "text";
            commentInput.classList.add("comment-input");
            if (profile.hasRose) {
              if (profile.comment && profile.comment.trim()) {
                commentInput.placeholder = "Comment sent!";
                commentInput.disabled = true;
                commentInput.classList.remove("enabled");
                commentInbox.classList.remove("enabled");
              } else {
                commentInput.placeholder = "Add a comment...";
                commentInput.disabled = false;
                commentInput.classList.add("enabled");
                commentInbox.classList.add("enabled");
              }
            } else {
              commentInput.placeholder = "Enable when you rose someone";
              commentInput.disabled = true;
              commentInput.classList.remove("enabled");
              commentInbox.classList.remove("enabled");
            }

            const sendIcon = document.createElement("img");
            sendIcon.src = "assets/icons/Comment-send.svg";
            sendIcon.alt = "Send Comment";
            sendIcon.classList.add("send-icon");
            commentInbox.appendChild(commentInput);
            commentInbox.appendChild(sendIcon);

            const heartButton = document.createElement("button");
            heartButton.classList.add("heart-button");
            // Explicitly set the active class based on profile.isLiked
            if (profile.isLiked) {
              heartButton.classList.add("active");
              console.log(
                `Profile ${profile._id} heart button initialized as active`
              );
            } else {
              heartButton.classList.remove("active");
              console.log(
                `Profile ${profile._id} heart button initialized as inactive`
              );
            }
            const heartIcon = document.createElement("img");
            heartIcon.src = "assets/icons/heart-icon.png";
            heartIcon.alt = "Heart Icon";
            heartIcon.classList.add("heart-icon");
            heartIcon.onerror = () => {
              console.error("Failed to load heart-icon.png, using fallback");
              heartButton.innerHTML = '<i class="fa-solid fa-heart"></i>';
            };
            heartButton.appendChild(heartIcon);

            buttonContainer.appendChild(noNamedButton);
            buttonContainer.appendChild(commentInbox);
            buttonContainer.appendChild(heartButton);

            profileCard.appendChild(profileImage);
            profileCard.appendChild(profileInfo);
            profileCard.appendChild(buttonContainer);

            profileList.appendChild(profileCard);

            // Heart button event listener
            heartButton.addEventListener("click", async function () {
              const wasLiked = this.classList.contains("active");
              this.classList.toggle("active"); // Toggle immediately for UI responsiveness

              const token = localStorage.getItem("jwtToken");
              if (!token) {
                await showCustomAlert("Please log in to like profiles!");
                this.classList.toggle("active", wasLiked); // Revert if not logged in
                return;
              }

              const profileId = profile._id;
              try {
                const response = await fetch(
                  "http://localhost:3000/api/like-profile",
                  {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                      Authorization: `Bearer ${token}`,
                    },
                    body: JSON.stringify({ profileId }),
                  }
                );

                const result = await response.json();
                if (response.ok) {
                  console.log("Like action successful:", result);
                  profile.isLiked = !wasLiked; // Update local profile state
                  console.log(
                    `Profile ${profile._id} isLiked updated to: ${profile.isLiked}`
                  );
                  // Ensure button state matches profile.isLiked
                  if (profile.isLiked) {
                    this.classList.add("active");
                  } else {
                    this.classList.remove("active");
                  }
                } else {
                  console.error("Like action failed:", result);
                  this.classList.toggle("active", wasLiked); // Revert on failure
                  await showCustomAlert(
                    "Failed to like/unlike profile: " + result.message
                  );
                }
              } catch (error) {
                console.error("Error performing like action:", error);
                this.classList.toggle("active", wasLiked); // Revert on error
                await showCustomAlert(
                  "An error occurred while liking/unliking the profile."
                );
              }
            });

            // Rose button event listener
            const externalRoseButton = document.querySelector(".rose-button");
            externalRoseButton.dataset.profileIndex = i;
            if (profile.hasRose) {
              externalRoseButton.classList.add("active");
              externalRoseButton.disabled = true;
            } else {
              externalRoseButton.classList.remove("active");
              externalRoseButton.disabled = false;
            }

            async function submitComment(
              profileId,
              commentText,
              commentInput,
              commentInbox
            ) {
              const token = localStorage.getItem("jwtToken");
              if (!token) {
                await showCustomAlert("Please log in to send a comment!");
                return;
              }

              try {
                const response = await fetch(
                  "http://localhost:3000/api/rose/comment",
                  {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                      Authorization: `Bearer ${token}`,
                    },
                    body: JSON.stringify({
                      toUser: profileId,
                      comment: commentText,
                    }),
                  }
                );

                const result = await response.json();
                if (response.ok) {
                  console.log("Comment attached to rose:", result);
                  commentInput.value = "";
                  commentInput.disabled = true;
                  commentInput.placeholder = "Comment sent!";
                  commentInput.classList.remove("enabled");
                  commentInbox.classList.remove("enabled");
                  profiles[i].comment = commentText;
                  await showCustomAlert("Comment sent successfully!");
                } else {
                  console.error("Failed to attach comment:", result);
                  await showCustomAlert(
                    result.message || "Failed to send comment"
                  );
                }
              } catch (error) {
                console.error("Error sending comment:", error);
                await showCustomAlert(
                  "An error occurred while sending the comment."
                );
              }
            }

            commentInput.addEventListener("keypress", function (event) {
              if (
                event.key === "Enter" &&
                !commentInput.disabled &&
                commentInput.value.trim()
              ) {
                submitComment(
                  profile._id,
                  commentInput.value.trim(),
                  commentInput,
                  commentInbox
                );
              }
            });

            sendIcon.addEventListener("click", function () {
              if (!commentInput.disabled && commentInput.value.trim()) {
                submitComment(
                  profile._id,
                  commentInput.value.trim(),
                  commentInput,
                  commentInbox
                );
              }
            });

            externalRoseButton.addEventListener("click", async function () {
              const profileIndex = parseInt(this.dataset.profileIndex);
              const currentProfile = profiles[profileIndex];
              const profileCard = profileList.children[profileIndex];
              const currentCommentInput =
                profileCard.querySelector(".comment-input");
              const currentCommentInbox =
                profileCard.querySelector(".comment-inbox");
              const token = localStorage.getItem("jwtToken");

              if (!token) {
                await showCustomAlert("Please log in to send a Rose!");
                return;
              }

              if (currentProfile.hasRose) {
                await showCustomAlert(
                  "You've already sent a Rose to this profile!"
                );
                return;
              }

              this.classList.add("shine");
              setTimeout(() => this.classList.remove("shine"), 600);

              const comment = currentCommentInput.value.trim();
              try {
                const response = await fetch("http://localhost:3000/api/rose", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                  },
                  body: JSON.stringify({
                    toUser: currentProfile._id,
                    comment: comment || "",
                  }),
                });

                const result = await response.json();
                if (response.ok) {
                  console.log("Rose sent:", result);
                  this.classList.add("active");
                  this.disabled = true;
                  currentCommentInput.disabled = false;
                  currentCommentInput.placeholder = comment
                    ? "Comment sent!"
                    : "Add a comment...";
                  currentCommentInput.classList.add("enabled");
                  currentCommentInbox.classList.add("enabled");
                  profiles[profileIndex].hasRose = true;
                  profiles[profileIndex].comment = comment || "";
                  if (comment) {
                    currentCommentInput.disabled = true;
                    currentCommentInput.classList.remove("enabled");
                    currentCommentInbox.classList.remove("enabled");
                  }
                  await showCustomAlert(
                    "Rose sent successfully! You can now add a comment."
                  );
                } else {
                  console.error("Failed to send Rose:", result);
                  await showCustomAlert(
                    result.message || "Failed to send Rose"
                  );
                }
              } catch (error) {
                console.error("Error sending Rose:", error);
                await showCustomAlert(
                  "An error occurred while sending the Rose."
                );
              }
            });

            [profileNameAge, profileDetails, profileBio].forEach((element) => {
              element.addEventListener("click", () =>
                showProfileDetails(profile)
              );
            });

            noNamedButton.addEventListener("click", function () {
              currentProfileIndex++;
              if (currentProfileIndex >= loadedProfiles) {
                if (loadedProfiles < profiles.length) {
                  loadProfiles();
                } else {
                  currentProfileIndex = loadedProfiles - 1;
                }
              }
              scrollToProfile(currentProfileIndex);
            });
          }

          loadedProfiles = end;

          if (start === 0) {
            scrollToProfile(0);
          }
        }

        function isNearBottom(element) {
          const lastProfile = element.lastElementChild;
          if (!lastProfile) return false;
          const lastProfileRect = lastProfile.getBoundingClientRect();
          const containerRect = element.getBoundingClientRect();
          return lastProfileRect.bottom <= containerRect.bottom + 50;
        }

        function scrollToProfile(index) {
          const profileList = document.getElementById("profileList");
          const profilesElements = profileList.children;
          if (index >= 0 && index < profilesElements.length) {
            const profileHeight = profilesElements[index].offsetHeight;
            profileList.scrollTo({
              top: index * profileHeight,
              behavior: "smooth",
            });

            const roseButton = document.querySelector(".rose-button");
            const saveButton = document.querySelector('button[title="Save"]');
            const currentProfile = profiles[index];
            roseButton.dataset.profileIndex = index;
            saveButton.dataset.profileIndex = index;

            const currentCommentInput =
              profilesElements[index].querySelector(".comment-input");
            const currentCommentInbox =
              profilesElements[index].querySelector(".comment-inbox");
            const currentHeartButton =
              profilesElements[index].querySelector(".heart-button");

            // Sync heart button state
            if (currentProfile.isLiked) {
              currentHeartButton.classList.add("active");
              console.log(
                `Profile ${currentProfile._id} heart button set to active in scrollToProfile`
              );
            } else {
              currentHeartButton.classList.remove("active");
              console.log(
                `Profile ${currentProfile._id} heart button set to inactive in scrollToProfile`
              );
            }

            if (currentProfile.hasRose) {
              roseButton.classList.add("active");
              roseButton.disabled = true;
              if (currentProfile.comment && currentProfile.comment.trim()) {
                currentCommentInput.disabled = true;
                currentCommentInput.placeholder = "Comment sent!";
                currentCommentInput.classList.remove("enabled");
                currentCommentInbox.classList.remove("enabled");
              } else {
                currentCommentInput.disabled = false;
                currentCommentInput.placeholder = "Add a comment...";
                currentCommentInput.classList.add("enabled");
                currentCommentInbox.classList.add("enabled");
              }
            } else {
              roseButton.classList.remove("active");
              roseButton.disabled = false;
              currentCommentInput.disabled = true;
              currentCommentInput.placeholder = "Enable when you rose someone";
              currentCommentInput.classList.remove("enabled");
              currentCommentInbox.classList.remove("enabled");
            }

            if (currentProfile.isSaved) {
              saveButton.classList.add("saved");
            } else {
              saveButton.classList.remove("saved");
            }
          }
        }

        let currentProfileIndex = 0;

        document
          .getElementById("profileList")
          .addEventListener("scroll", function () {
            const profileList = this;
            const profilesElements = profileList.children;

            for (let i = 0; i < profilesElements.length; i++) {
              const profileRect = profilesElements[i].getBoundingClientRect();
              const containerRect = profileList.getBoundingClientRect();
              if (
                profileRect.top >= containerRect.top - 50 &&
                profileRect.bottom <= containerRect.bottom + 50
              ) {
                currentProfileIndex = i;
                scrollToProfile(currentProfileIndex);
                break;
              }
            }

            if (isNearBottom(profileList) && loadedProfiles < profiles.length) {
              loadProfiles();
            }
          });

        document
          .getElementById("profileList")
          .addEventListener("keydown", function (event) {
            if (event.key === "ArrowDown") {
              event.preventDefault();
              currentProfileIndex++;
              if (currentProfileIndex >= loadedProfiles) {
                currentProfileIndex = loadedProfiles - 1;
                if (loadedProfiles < profiles.length) {
                  loadProfiles();
                }
              }
              scrollToProfile(currentProfileIndex);
            } else if (event.key === "ArrowUp") {
              event.preventDefault();
              currentProfileIndex--;
              if (currentProfileIndex < 0) {
                currentProfileIndex = 0;
              }
              scrollToProfile(currentProfileIndex);
            }
          });

        document.getElementById("profileList").setAttribute("tabindex", "0");
        document.getElementById("profileList").focus();

        document
          .querySelectorAll(".side-navbar .top-items a")
          .forEach((link) => {
            link.addEventListener("mouseenter", () => {
              document
                .querySelectorAll(".side-navbar .top-items a")
                .forEach((otherLink) => {
                  if (otherLink !== link) {
                    otherLink.style.filter = "blur(2px)";
                  }
                });
            });

            link.addEventListener("mouseleave", () => {
              document
                .querySelectorAll(".side-navbar .top-items a")
                .forEach((otherLink) => {
                  otherLink.style.filter = "none";
                });
            });
          });

        function showProfileDetails(profile) {
          console.log("Profile object:", profile);
          const profileList = document.getElementById("profileList");
          const profileDetailsBox =
            document.getElementById("profileDetailsBox");
          const profileName = document.getElementById("profileName");
          const profileImage = document.getElementById("profileImage");
          const scrollContainer = document.getElementById("scrollContainer");
          const profileDetailsContent = document.getElementById(
            "profileDetailsContent"
          );

          profileList.classList.add("blur");

          profileName.textContent = profile.name || "Unknown";
          const firstImage =
            profile.photos && profile.photos.length > 0
              ? profile.photos[0]
              : profile.image || "default-image.jpg";
          profileImage.src = firstImage;
          profileImage.alt = `${profile.name || "Unknown"}'s image 1`;

          scrollContainer.innerHTML = "";
          const details = [
            { icon: "fa-regular fa-user", text: profile.age || "N/A" },
            { icon: "fa-solid fa-graduation-cap", text: profile.year || "N/A" },
            {
              icon: "fa-solid fa-book-open",
              text: profile.courseStudy || "N/A",
            },
            { icon: "fa-solid fa-ruler", text: profile.height || "N/A" },
            { icon: "fa-solid fa-house", text: profile.hometown || "N/A" },
          ];
          details.forEach((item) => {
            const span = document.createElement("span");
            span.classList.add("scroll-item");
            span.innerHTML = `<i class="${item.icon}"></i>${item.text}`;
            scrollContainer.appendChild(span);
          });

          while (profileDetailsContent.children.length > 2) {
            profileDetailsContent.removeChild(profileDetailsContent.lastChild);
          }

          const additionalImages = (
            profile.photos ? profile.photos.slice(1, 4) : []
          ).filter((src) => src);
          const quotes = (profile.quotes || [])
            .filter((quote) => quote && quote.trim() !== "")
            .slice(0, 3);

          const contentItems = [
            ...additionalImages.map((src, index) => ({
              type: "image",
              src,
              alt: `${profile.name || "Unknown"}'s image ${index + 2}`,
            })),
            ...quotes.map((text) => ({ type: "quote", text })),
          ];

          for (let i = contentItems.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [contentItems[i], contentItems[j]] = [
              contentItems[j],
              contentItems[i],
            ];
          }

          contentItems.forEach((item) => {
            const section = document.createElement("div");
            section.classList.add("detail-section");

            if (item.type === "image") {
              const img = document.createElement("img");
              img.src = item.src;
              img.alt = item.alt;
              section.appendChild(img);
            } else if (item.type === "quote") {
              const p = document.createElement("p");
              p.classList.add("quote");
              p.innerHTML = `<strong></strong> "${item.text}"`;
              section.appendChild(p);
            }

            profileDetailsContent.appendChild(section);
          });

          profileDetailsBox.classList.add("active");

          const detailHeartButton = document.querySelector(
            ".detail-heart-button"
          );
          // Initialize based on a new property, e.g., profile.isPhotoLiked (set this elsewhere if needed)
          if (profile.isPhotoLiked) {
            detailHeartButton.classList.add("active");
            console.log(
              `Profile ${profile._id} detail heart button initialized as active`
            );
          } else {
            detailHeartButton.classList.remove("active");
            console.log(
              `Profile ${profile._id} detail heart button initialized as inactive`
            );
          }

          // Remove any previous event listeners
          detailHeartButton.replaceWith(detailHeartButton.cloneNode(true));
          const newDetailHeartButton = document.querySelector(
            ".detail-heart-button"
          );

          // Add event listener with new endpoint
          newDetailHeartButton.addEventListener("click", async function (e) {
            e.preventDefault();

            const token = localStorage.getItem("jwtToken");
            if (!token) {
              showCustomAlert("Please log in to like photos.");
              return;
            }

            const isCurrentlyLiked = this.classList.contains("active");
            this.classList.toggle("active"); // Immediate UI feedback

            try {
              const response = await fetch(
                "http://localhost:3000/api/like-photo",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                  },
                  body: JSON.stringify({
                    profileId: profile._id,
                    isLiked: !isCurrentlyLiked, // Explicitly send the new state
                  }),
                }
              );

              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(
                  errorData.message || "Failed to like/unlike photo"
                );
              }

              const result = await response.json();
              profile.isPhotoLiked = result.isLiked; // Track photo-specific like state
              console.log(
                `Photo for profile ${profile._id} ${
                  profile.isPhotoLiked ? "liked" : "unliked"
                } successfully`
              );

              // No sync with heart-button since they’re separate
            } catch (error) {
              console.error("Error liking/unliking photo:", error);
              this.classList.toggle("active"); // Revert UI on error
              showCustomAlert(`Error: ${error.message}`);
            }
          });
        }

        window.closeProfileDetails = function () {
          const profileList = document.getElementById("profileList");
          const profileDetailsBox =
            document.getElementById("profileDetailsBox");
          const profileName = document.getElementById("profileName");
          const profileImage = document.getElementById("profileImage");
          const scrollContainer = document.getElementById("scrollContainer");
          const profileDetailsContent = document.getElementById(
            "profileDetailsContent"
          );

          profileDetailsBox.classList.remove("active");
          profileName.textContent = "";
          profileImage.src = "";
          profileImage.alt = "";
          scrollContainer.innerHTML = "";

          while (profileDetailsContent.children.length > 2) {
            profileDetailsContent.removeChild(profileDetailsContent.lastChild);
          }

          profileList.classList.remove("blur");
        };

        const profileDetailsBox = document.getElementById("profileDetailsBox");
        profileDetailsBox.addEventListener(
          "wheel",
          (event) => event.stopPropagation(),
          {
            passive: false,
          }
        );
        profileDetailsBox.addEventListener(
          "touchmove",
          (event) => event.stopPropagation(),
          {
            passive: false,
          }
        );

        const shareButton = document.querySelector('button[title="Share"]');
        const shareOptions = document.querySelector(".share-options");

        if (shareButton && shareOptions) {
          shareButton.addEventListener("click", (e) => {
            e.stopPropagation();
            shareOptions.classList.toggle("active");
          });

          document.addEventListener("click", (e) => {
            if (
              !shareOptions.contains(e.target) &&
              !shareButton.contains(e.target)
            ) {
              shareOptions.classList.remove("active");
            }
          });

          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
              shareOptions.classList.remove("active");
            }
          });

          function shareProfile(platform) {
            const profile = profiles[currentProfileIndex];
            const shareUrl = `${window.location.origin}/profile?id=${profile._id}`;
            const shareText = `Check out ${
              profile.name || "this user"
            }'s profile on Amourette: ${profile.bio || "No bio"}`;

            switch (platform) {
              case "whatsapp":
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(
                  shareText + " " + shareUrl
                )}`;
                window.open(whatsappUrl, "_blank");
                break;
              case "twitter":
                const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
                  shareText
                )}&url=${encodeURIComponent(shareUrl)}`;
                window.open(twitterUrl, "_blank");
                break;
              default:
                showCustomAlert(`Sharing on ${platform} is not supported yet.`);
            }

            shareOptions.classList.remove("active");
          }

          document.querySelectorAll(".share-option").forEach((option) => {
            option.addEventListener("click", () => {
              const platform = option.getAttribute("data-platform");
              shareProfile(platform);
            });
          });
        } else {
          console.error(
            "Share button or share options container not found in the DOM."
          );
        }

        document
          .querySelector('button[title="Save"]')
          .addEventListener("click", async function () {
            const currentProfile = profiles[currentProfileIndex];
            const token = localStorage.getItem("jwtToken");
            if (!token) {
              console.error("No JWT token found");
              await showCustomAlert("Please log in to save profiles!");
              return;
            }

            if (currentProfile.isSaved) {
              await showCustomAlert("Profile already saved!");
              return;
            }

            this.classList.add("saved");

            try {
              const response = await fetch(
                "http://localhost:3000/api/save-profile",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                  },
                  body: JSON.stringify({ profileId: currentProfile._id }),
                }
              );

              const result = await response.json();
              if (response.ok) {
                console.log("Save successful:", result);
                currentProfile.isSaved = true;
                await showCustomAlert("Profile saved successfully!");
              } else {
                console.error("Save failed:", result);
                this.classList.remove("saved");
                await showCustomAlert(
                  "Failed to save profile: " + result.message
                );
              }
            } catch (error) {
              console.error("Error saving profile:", error);
              this.classList.remove("saved");
              await showCustomAlert(
                "An error occurred while saving the profile."
              );
            }
          });
      });

      function toggleSidebar() {
        const sideNavbar = document.getElementById("sideNavbar");
        const hamburger = document.querySelector(".hamburger");
        const isActive = sideNavbar.classList.toggle("active");

        if (isActive) {
          hamburger.classList.add("hidden");
        } else {
          hamburger.classList.remove("hidden");
        }
      }
    </script>
  </body>
</html>
